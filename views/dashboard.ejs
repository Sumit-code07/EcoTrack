<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="logo"><h2>EcoTrack</h2></div>
        <div class="nav">
            <ul type="none">
                <li><a href="#">Home</a></li>
                <li><a href="#">About Us</a></li>
                <li><a href="/leaderboard">leaderboard</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">AI Advice</a></li>
            </ul>
        </div>
        <img src="https://img.freepik.com/free-vector/businessman-character-avatar-isolated_24877-60111.jpg" alt="" class="profile">
    </header>
    <h1>Hello <%=user.name%></h1>

     <div class="table-container">
    <h2>COâ‚‚ Emission Report</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>COâ‚‚ Emission (kg)</th>
        </tr>
      </thead>
      <tbody>
        <%for(data of datas){%>
            <tr><td><%=data.date%></td><td><%=data.totalCO2%></td></tr>
        <%}%>
      </tbody>
      
    </table>
  </div>
  <div class="chart-container" style="width:80%; margin:40px auto;">
    <h3 style="text-align:center;">COâ‚‚ Emission Trend</h3>
    <canvas id="co2Chart" style="width:100%; height:400px;"></canvas>
  </div>

  <div style="text-align:center;">
    <a href="/vehicles/<%= user.id %>">Calculate COâ‚‚ Emission</a>
  </div>

  <script>
    // Convert EJS data to JS arrays
    const dates = JSON.parse('<%- JSON.stringify(datas.map(d => new Date(d.date).toLocaleDateString("en-IN"))) %>');
    const emissions = JSON.parse('<%- JSON.stringify(datas.map(d => d.totalCO2)) %>');
  
  console.log("ðŸ“… Dates from server:", dates);
  console.log("ðŸ’¨ Emissions from server:", emissions);

    const ctx = document.getElementById('co2Chart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'COâ‚‚ Emission (kg)',
          data: emissions,
          borderColor: '#0078d7',
          backgroundColor: 'rgba(0,120,215,0.2)',
          borderWidth: 2,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>
  <div>
        <a href="/vehicles/<%=user.id%>">Calculate COâ‚‚ Emission<a>
      </div>
</body>
</html>
